# 周报处理 - 季度工时统计报告生成器

## 📁 项目结构

```
d:\Project\周报处理\
├── 2025年1-6.csv                           # 原始周报数据文件
├── 2025年1-6.xlsx                          # 原始Excel文件（备份）
├── generate_final_optimized_report.py      # 核心脚本：生成最终优化格式报告
├── 最终优化格式季度工时统计报告.csv           # 输出：最终报告文件
├── 最终优化格式说明.md                      # 使用说明文档
├── Pipfile                                 # Python依赖管理
├── Pipfile.lock                           # 依赖版本锁定
└── README.md                              # 项目说明文档
```

## 🚀 快速开始

### 1. 环境准备
```bash
# 安装依赖
pipenv install

# 激活虚拟环境
pipenv shell
```

### 2. 运行脚本
```bash
# 生成最终优化格式报告
pipenv run python generate_final_optimized_report.py
```

### 3. 查看结果
- 输出文件：`最终优化格式季度工时统计报告.csv`
- 使用说明：`最终优化格式说明.md`

## 📊 功能特点

### 核心功能
- ✅ 从原始周报CSV文件直接生成季度统计报告
- ✅ 自动合并T1和T1电子元件部门
- ✅ 计算项目总人天和季度总人天
- ✅ 所有单元格填入具体数值，便于Excel手动合并
- ✅ UTF-8-BOM编码，确保中文正确显示

### 表格格式
```
订单项目.归属中心 | 订单项目.立项项目 | 项目总人天 | 季度 | 季度总人天 | 人员 | 人天
```

### 数据处理逻辑
- **季度划分**: 第1季度(1-13周)、第2季度(14-26周)
- **项目总人天**: 该项目在所有季度的工时总和
- **季度总人天**: 该项目在当前季度的工时总和
- **排序规则**: 部门 → 项目 → 季度 → 人天数(降序)

## 📋 依赖说明

### Python包
- `pandas`: 数据处理和分析
- `chardet`: 字符编码检测

### 输入文件要求
- 文件名：`2025年1-6.csv`
- 编码：支持UTF-8、GBK、GB2312等
- 必需列：
  - 周报人
  - 周次
  - 订单项目.立项项目
  - 订单项目.归属中心
  - 订单项目.本周投入天数（最低半天）

## 🎯 使用场景

### 1. 管理层汇报
- 清晰展示各部门项目投入情况
- 便于识别重点项目和资源分配

### 2. 项目管理
- 跟踪项目进度和人员投入
- 分析季度间工作重心变化

### 3. Excel进一步处理
- 所有单元格都有数值，便于手动合并
- 支持数据透视表等高级功能

## 💡 Excel使用建议

### 打开CSV文件
1. 直接双击打开，或在Excel中导入
2. 确保选择UTF-8编码以正确显示中文

### 手动合并单元格
1. 选中相同内容的单元格区域
2. 右键 → "设置单元格格式" → "对齐" → "合并单元格"
3. 添加边框和颜色美化

### 建议合并的列
- 部门列：合并同一部门的所有行
- 项目列：合并同一项目的所有行
- 项目总人天列：合并同一项目的所有行
- 季度列：合并同一项目同一季度的所有行
- 季度总人天列：合并同一项目同一季度的所有行

## 🔧 维护说明

### 修改季度划分
在 `get_quarter()` 函数中修改周次范围：
```python
def get_quarter(week):
    if 1 <= week <= 13:
        return 1
    elif 14 <= week <= 26:
        return 2
    # 添加更多季度...
```

### 修改部门合并规则
在 `merge_departments()` 函数中添加更多合并规则：
```python
def merge_departments(df):
    df_copy = df.copy()
    df_copy['订单项目.归属中心'] = df_copy['订单项目.归属中心'].replace({
        'T1电子元件': 'T1',
        # 添加更多合并规则...
    })
    return df_copy
```

### 修改输入文件
在 `main()` 函数中修改文件路径：
```python
input_file = '新的文件名.csv'
```

## 📞 技术支持

如需修改功能或遇到问题，请参考：
1. `最终优化格式说明.md` - 详细使用说明
2. 脚本中的注释和文档字符串
3. 代码结构清晰，便于理解和修改

---
*项目版本: v1.0*  
*最后更新: 2025年7月*
